<!DOCTYPE html>
<html class="x-admin-sm">
    <head>
        <meta charset="utf-8"/>
        <title>地址管理-信息抓取系统</title>
        <meta content="webkit" name="renderer"/>
        <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible"/>
        <meta content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8" name="viewport"/>
        <!-- viewport 属性在 Chrome 不支持 target-densitydpi=low-dpi  -->
        <meta content="no-siteapp" http-equiv="Cache-Control"/>
        <link href="__XADMIN__/css/font.css" rel="stylesheet"/>
        <link href="__XADMIN__/css/xadmin.css" rel="stylesheet"/>
        <script charset="utf-8" src="__XADMIN__/lib/layui/layui.js">
        </script>
        <script src="__XADMIN__/js/xadmin.js" type="text/javascript">
        </script>
        <!-- 让IE8/9支持媒体查询，从而兼容栅格 -->
        <!--[if lt IE 9]>
            <script src="https://cdn.staticfile.org/html5shiv/r29/html5.min.js"></script>
            <script src="https://cdn.staticfile.org/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
    </link>
</link>
</head>
<body>
<div class="x-nav">
    <span class="layui-breadcrumb" style="visibility: visible;">
        <a href="">首页</a>
        <span lay-separator="">/</span>
        <a href="">地址管理</a>
        <span lay-separator="">/</span>
        <a>
            <cite>地址列表</cite>
        </a>
    </span>
    <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
        <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
    </a>
</div>
<div class="layui-fluid">
    <div class="layui-row">
        <div class="layui-col-md12">
            <div class="layui-card">
                <div class="layui-card-body ">
                    <table id="logList" lay-filter="logList"></table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
        layui.use(['table','form', 'layer','jquery'], function() {
            $ = layui.jquery;
            var form = layui.form,
            table = layui.table,
            layer = layui.layer;

            // 数据表格
            var ins = table.render({
                elem: '#logList'
                ,url: '{:url("getList")}'
                ,method: 'post'
                ,toolbar: '#toolbar'
                ,page: true
                ,limit: 7
                ,height: 'full-120'
                ,title: '地址列表'
                ,text: {
                    none: '暂无相关数据'
                }
                ,done: function(res, curr, count){
                    // console.log(res.msg);
                    form.val("toolbarSelect",{
                        "addrpool": res.msg
                    });
                }
                ,cols: [[
                {field: 'id', title: 'ID', width:80, sort: true, fixed: 'left'}
                ,{field: 'name', title: '地址名称', sort: true}
                ,{field: 'auto_url', title: '抓取目录地址', sort: true, templet: function(d){
                    return '<a href="' + d.auto_url + '" target="blank">' + d.auto_url + '</a>';
                }}
                ,{field: 'is_auto', title: '是否为自动抓取', width:130, sort: true}
                ,{field: 'created_at', title: '操作时间', width: 150}
                ,{fixed: 'right', width:150, align:'center', toolbar: '#bar'}
                ]]
            });
            // 监听左上角的工具栏事件
            table.on('toolbar(logList)', function(obj){
                var checkStatus = table.checkStatus(obj.config.id);
                switch(obj.event){
                    case 'add':
                    // layer.msg('添加');
                    xadmin.open("地址信息添加",'{:url("add")}',600,400);
                    break;
                };
            });
            // 监听选择框选择事件（分类选择）
            form.on('select()', function(data){
                // console.log(data.value);
                ins.reload({
                    where: {
                        addrpool_id: data.value
                    }
                    ,page: {
                        curr: 1
                    }
                });
            });
            // 监听右上角的工具条事件
            table.on('tool(logList)', function(obj){
                var data = obj.data; //获得当前行数据
                var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
                var tr = obj.tr; //获得当前行 tr 的 DOM 对象（如果有的话）
                if(layEvent === 'edit'){
                    xadmin.open("地址信息修改",'{:url("edit")}?id=' + data.id,600,400);
                }else if (layEvent === 'del') {
                    layer.confirm("确定删除 " + data.name + " 地址吗？",{
                        title: '删除地址确认框',
                        btn: ['狠心删除','我再想想']
                    },function(){
                        $.post("{:url('del')}",{id: data.id},function(res){
                            if(res.code > 0){
                                // 操作失败
                                layer.msg(res.msg,{icon: 2});
                            }else{
                                layer.msg(res.msg, {
                                    icon: 1,
                                    time: 2000
                                }, function(){
                                    obj.del();
                                });
                            }
                        },"json");
                    });
                }
            });
        });
    </script>
<!-- 顶部左侧工具栏 -->
<script type="text/html" id="toolbar" >
    <div class="layui-form" lay-filter="toolbarSelect">
        <div class="layui-inline">
            <div class="layui-input-inline" style="width: auto;">
                <button class="layui-btn layui-btn-sm" lay-event="add">添加地址</button>
            </div>
            <div class="layui-input-inline">
                <select name="addrpool" lay-verify="" lay-search lay-event="addrpool">
                    <option selected value="0">默认展示所有地址池</option>
                    {volist name="addrpool" id="item"}
                    <option value="{$item.id}">{$item.name} 地址池</option>
                    {/volist}
                </select>
            </div>
        </div>
    </div>
</script>
<!-- 每行的右侧列工具栏 -->
<script type="text/html" id="bar">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
</body>
</html>
